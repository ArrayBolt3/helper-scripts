#!/bin/bash

## Copyright (C) 2025 - 2025 ENCRYPTED SUPPORT LLC <adrelanos@whonix.org>
## See the file COPYING for copying conditions.

set -o errexit
set -o nounset
set -o errtrace
set -o pipefail

true "$0: START"

source /usr/libexec/helper-scripts/set-keyboard-layout.sh

print_usage() {
  printf '%s\n' "$0: Set keyboard layout for labwc" >&2
  printf '%s\n' "Usage: $0 [--help] [--persist] [--no-reload] [--config <path>] [--interactive] -- [layout [variant [option]]]" >&2
  printf '%s\n' 'Options:' >&2
  printf '%s\n' '--help           Print this help message.' >&2
  printf '%s\n' '--persist        Make layout change persistent.' >&2
  printf '%s\n' '--no-reload      Skip reloading labwc config. Only useful with --persist.' >&2
  printf '%s\n' '--config <path>  Specify an alternative config file path.' >&2
  printf '%s\n' '--interactive    Show an interactive user interface.' >&2
  printf '\n' >&2
  printf '%s\n' 'Examples:' >&2
  printf '%s\n' '  set-labwc-keymap de' >&2
  printf '%s\n' '  set-labwc-keymap --persist us colemak' >&2
  printf '%s\n' '  set-labwc-keymap us,cz,de "" grp:alt_shift_toggle' >&2
}

## Enter interactive mode if requested.
for opt in "$@"; do
  if [ "${opt}" = '--' ]; then
    break
  fi
  if [ "${opt}" = '--interactive' ]; then
    interactive_ui 'set_labwc_keymap' --persist || exit 1
    exit 0
  fi
done
set_labwc_keymap "$@" || exit 1

true "$0: END"
