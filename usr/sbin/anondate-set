#!/bin/bash

## Copyright (C) 2014 - 2020 ENCRYPTED SUPPORT LP <adrelanos@riseup.net>
## See the file COPYING for copying conditions.

set -e

if [ "$(id -u)" != "0" ]; then
   echo "$0: ERROR: Must run as root."
   exit 112
fi

anondate_get_exit_code=0
time_result="$(anondate-get)" || { anondate_get_exit_code="$?" ; true; };

if [ ! "$anondate_get_exit_code" = "0" ]; then
   echo "$0: INFO: Setting time using anondate either not possible or not required."
   echo "$0: INFO: Output of anondate-get:"
   echo "$time_result"
   echo "$0: INFO: Exiting."
   exit 1
fi

echo "$0: INFO: Running: 'date --utc --set "$time_result"'"
date --utc --set "$time_result"
echo "$0: INFO: Exiting."
